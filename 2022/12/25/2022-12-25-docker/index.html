<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="computer science">
    
    <meta name="author" content="fetch150zy">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://fetch150zy.github.io/2022/12/25/2022-12-25-docker/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="基于 golang 开发的容器化技术 docker Dockerdocker 核心技术隔离性 Linux namespace   每个用户实例之间隔离，互不影响   pid namespace 隔离不同用户的进程，并且不同的namespace可以有相同的pid。  net namespace 实现网络隔离，默认通过veth的方式将container中的虚拟网卡同host上的docker bridg">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="https://fetch150zy.github.io/2022/12/25/2022-12-25-docker/index.html">
<meta property="og:site_name" content="fetch150zy&#39;blog">
<meta property="og:description" content="基于 golang 开发的容器化技术 docker Dockerdocker 核心技术隔离性 Linux namespace   每个用户实例之间隔离，互不影响   pid namespace 隔离不同用户的进程，并且不同的namespace可以有相同的pid。  net namespace 实现网络隔离，默认通过veth的方式将container中的虚拟网卡同host上的docker bridg">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic.fetch150zy.cn/assets/dockerCore1.jpg">
<meta property="og:image" content="https://pic.fetch150zy.cn/assets/dockerCore2.jpg">
<meta property="og:image" content="https://pic.fetch150zy.cn/assets/dockerCore3.jpg">
<meta property="og:image" content="https://pic.fetch150zy.cn/assets/dockerCore4.jpg">
<meta property="og:image" content="https://pic.fetch150zy.cn/assets/dockerCore5.jpg">
<meta property="og:image" content="https://pic.fetch150zy.cn/assets/dockerfile.jpg">
<meta property="article:published_time" content="2022-12-25T04:00:00.000Z">
<meta property="article:modified_time" content="2024-03-23T05:45:43.513Z">
<meta property="article:author" content="fetch150zy">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.fetch150zy.cn/assets/dockerCore1.jpg">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/img/pacman.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/pacman.png">
    <meta name="theme-color" content="#7FCDCD">
    <link rel="shortcut icon" href="/img/pacman.png">
    <!--- Page Info-->
    
    <title>
        
            Docker -
        
        fetch150zy&#39;s blog
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
        <style>
    :root {
        --preloader-background-color: #fff;
        --preloader-text-color: #000;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --preloader-background-color: #202124;
            --preloader-text-color: #fff;
        }
    }

    @media (prefers-color-scheme: light) {
        :root {
            --preloader-background-color: #fff;
            --preloader-text-color: #000;
        }
    }

    @media (max-width: 600px) {
        .ml13 {
            font-size: 2.6rem !important; /* Adjust this value as needed */
        }
    }

    .preloader {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Tailwind 'gap-4' is 1rem */
        align-items: center;
        justify-content: center;
        position: fixed;
        padding: 12px;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh; /* 'h-screen' is 100% of the viewport height */
        background-color: var(--preloader-background-color);
        z-index: 1100; /* 'z-[1100]' sets the z-index */
        transition: opacity 0.2s ease-in-out;
    }

    .ml13 {
        font-size: 3.2rem;
        /* text-transform: uppercase; */
        color: var(--preloader-text-color);
        letter-spacing: -1px;
        font-weight: 500;
        font-family: 'Chillax-Variable', sans-serif;
        text-align: center;
    }

    .ml13 .word {
        display: inline-flex;
        flex-wrap: wrap;
        white-space: nowrap;
    }

    .ml13 .letter {
        display: inline-block;
        line-height: 1em;
    }
</style>

<div class="preloader">
    
<script src="/js/libs/anime.min.js"></script>

    <h1 class="ml13">
        fetch150zy&#39;s blog
    </h1>
    <script>
        var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });


        anime.timeline({loop: true})
            .add({
                targets: '.ml13 .letter',
                translateY: [100,0],
                translateZ: 0,
                opacity: [0,1],
                easing: "easeOutExpo",
                duration: 1400,
                delay: (el, i) => 300 + 30 * i
            }).add({
            targets: '.ml13 .letter',
            translateY: [0,-100],
            opacity: [1,0],
            easing: "easeInExpo",
            duration: 1200,
            delay: (el, i) => 100 + 30 * i
        });

        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            hidePreloaderAfterTimeout(1000); // Hide after 1000 milliseconds once the window has loaded
        });

        // Backup failsafe: Hide preloader after a maximum of 5000 milliseconds, regardless of the window load event
        hidePreloaderAfterTimeout(5000);

        function hidePreloaderAfterTimeout(delay) {
            setTimeout(function () {
                var preloader = document.querySelector('.preloader');
                preloader.style.opacity = '0';
                setTimeout(function () {
                    preloader.style.display = 'none';
                }, 200);
            }, delay);
        }
    </script>
</div>
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    <!--- Font Part-->
    
    
    
    


    <script id="hexo-configurations">
    window.config = {"hostname":"fetch150zy.github.io","root":"/","language":"zh-CN"};
    window.theme = {"articles":{"style":{"font_size":"18px","line_height":1.4,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"center","headings_top_spacing":{"h1":"5rem","h2":"4rem","h3":"2.8rem","h4":"2.5rem","h5":"2.2rem","h6":"2rem"}},"word_count":{"enable":false,"count":false,"min2read":false},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":false,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":6,"number":false,"expand":true,"init_open":true},"copyright":{"enable":false,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":null,"skip_dirs":[]}},"colors":{"primary":"#7FCDCD","secondary":null,"default_mode":"dark"},"global":{"fonts":{"chinese":{"enable":null,"family":null,"url":null},"english":{"enable":null,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":true},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":false,"site_pv":false,"site_uv":false,"post_pv":false},"single_page":true,"preloader":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/img/bg15.jpg","dark":"/img/bg15.jpg"},"title":"fetch150zy's blog","subtitle":{"text":["年年岁岁花相似，岁岁年年人不同"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.3},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"style":"default","links":{"github":"https://github.com/fetch150zy","bilibili":"https://space.bilibili.com/505867894","stack-overflow":"https://stackoverflow.com/users/16738249/fetch150zy","email":"mailto:mars_zhewei@outlook.com"},"qrs":{"weixin":"https://pic.fetch150zy.cn/weixin.png"}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.6.1","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Blog":"https://fetch150zy.cn","Github":"https://github.com/fetch150zy"}}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":3,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"right","first_item":"info","announcement":null,"show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"YYYY-MM-DD","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":null};
    window.lang_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
        
<link rel="stylesheet" href="/fontawesome/sharp-solid.min.css">

    
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
<!--        <span class="swup-progress-icon">-->
<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
<!--        </span>-->
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container px-6 md:px-12">

    <div class="navbar-content ">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/img/pacman.png">
                </a>
            
            <a class="logo-title" href="/">
                
                fetch150zy&#39;s blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    首页
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    归档
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    关于
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a href="/about">
                                                    ME
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://fetch150zy.cn">
                                                    BLOG
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/fetch150zy">
                                                    GITHUB
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                首页
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                归档
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-About"
                        >
                            <span>
                                关于
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-About">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/about">ME</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://fetch150zy.cn">BLOG</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/fetch150zy">GITHUB</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/tags"
                        >
                            <span>Tags</span>
                            <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/categories"
                        >
                            <span>Categories</span>
                            <i class="fa-regular fa-folder fa-sm fa-fw"></i>
                        </a>
                    </li>
                
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">20</div>
        <div class="label text-third-text-color text-sm">标签</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">18</div>
        <div class="label text-third-text-color text-sm">分类</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">52</div>
        <div class="label text-third-text-color text-sm">文章</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container flex relative justify-between box-border w-full h-full">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                
                
                <img src="/../img/bg/21.png" alt="Docker" class="w-full h-60 sm:h-72 md:h-80 object-cover sm:rounded-t-large dark:brightness-75"/>
                
                <div class="w-full flex items-center absolute bottom-0 justify-center">
                    <h1 class="article-title-cover text-center mx-6 my-6 text-second-text-color bg-background-color-transparent px-4 py-3 text-3xl sm:text-4xl md:text-5xl font-bold backdrop-blur-lg rounded-xl border border-border-color ">Docker</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/img/avatar.jpg">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">fetch150zy</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2022-12-25 12:00</span>
        <span class="mobile">2022-12-25 12:00</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-03-23 13:45:43</span>
            <span class="mobile">2024-03-23 13:45:43</span>
            <span class="hover-info">更新</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Distributed/">Distributed</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Docker/">Docker</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <p>基于 golang 开发的容器化技术 docker</p>
<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="docker-核心技术"><a href="#docker-核心技术" class="headerlink" title="docker 核心技术"></a>docker 核心技术</h2><h3 id="隔离性-Linux-namespace"><a href="#隔离性-Linux-namespace" class="headerlink" title="隔离性 Linux namespace"></a>隔离性 Linux namespace</h3><blockquote>
<p>  每个用户实例之间隔离，互不影响</p>
</blockquote>
<ul>
<li><p>pid namespace</p>
<p>隔离不同用户的进程，并且不同的namespace可以有相同的pid。</p>
</li>
<li><p>net namespace</p>
<p>实现网络隔离，默认通过veth的方式将container中的虚拟网卡同host上的docker bridge: docker0连接</p>
</li>
<li><p>ipc namespace</p>
<p>进程交互，在IPC资源申请时加入namespace信息-每个IPC资源都有一个唯一的32位ID。</p>
</li>
<li><p>mnt namespace</p>
<p>允许不同namespace的进程看到的文件结构不同，文件目录被隔离开。</p>
</li>
<li><p>uts namespace</p>
<p>允许每个容器有独立的host name和domain name，使其在网络上可被视为一个独立的结点而非host上的一个进程</p>
</li>
<li><p>user namespace</p>
<p>不同容器拥有不同user和group id。</p>
</li>
</ul>
<h3 id="控制组-Cgroups"><a href="#控制组-Cgroups" class="headerlink" title="控制组 Cgroups"></a>控制组 Cgroups</h3><blockquote>
<p>  控制组 – 可配额、可度量</p>
<p>  在&#x2F;cgroup目录下新建一个文件夹即可新建一个group，在此文件夹中新建task文件，并将pid写入该文件，即可实现对资源的控制。</p>
</blockquote>
<ul>
<li>blkio限制每个块设备的输入输出控制。光盘、磁盘、usb等。</li>
<li>cpu使用调度程序为cgroup任务提供cpu的访问</li>
<li>cpuacct产生cgroup任务的cpu资源报告</li>
<li>cpuset针对多核心cpu，会为cgroup任务分配单独的cpu和内存</li>
<li>devices允许或拒绝cgroup任务对设备的访问</li>
<li>freezer暂停或恢复cgroup任务</li>
<li>memory设置每个cgroup内存限制以及内存资源报告</li>
<li>net_cts标记每个网络包供cgroup使用</li>
<li>ns名称空间子空间</li>
</ul>
<h3 id="便携性：AUFS"><a href="#便携性：AUFS" class="headerlink" title="便携性：AUFS"></a>便携性：AUFS</h3><blockquote>
<p>  支持将不同目录挂载在同一虚拟文件系统下的文件系统</p>
<p>  支持为每一个成员目录（类似于Git branch）设置读写权限</p>
<p>  AUFS中有类似分层的概念，对readonly权限的branch可以逻辑上进行修改（增量的，不影响readonly部分的）</p>
<blockquote>
<p>  实现不借助LVM，RAID将多个disk挂载在同一目录下</p>
</blockquote>
<blockquote>
<p>  讲一个readonly的branch和一个writeable的branch联合在一起，live CD正是基于此方法可以在OS image不变的基础上允许用户在其上进行写操作</p>
</blockquote>
</blockquote>
<ul>
<li><p>典型的启动Linux运行需要两个FS：bootfs，rootfs</p>
<p>bootfs(lxc, aufs&#x2F;btrfs, kernel) -&gt; rootfs(&#x2F;dev, &#x2F;proc, &#x2F;bin, &#x2F;etc, &#x2F;usr, &#x2F;tmp …)</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic.fetch150zy.cn/assets/dockerCore1.jpg"
                      alt="image"
                ></p>
<ul>
<li>bootfs(boot file system)主要包含bootloader和kernel，bootloader主要引导加载kernel，当boot成功后kernel被加载到内存中后bootfs被umount。</li>
<li>rootfs(root file system)包含典型Linux系统中的&#x2F;dev, &#x2F;proc, &#x2F;bin, &#x2F;etc等标准目录和文件</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic.fetch150zy.cn/assets/dockerCore2.jpg"
                      alt="image"
                ></p>
<ul>
<li>readonly方式加载并检查，然后利用union mount的方式将readwrite文件系统挂载在readonly的rootfs上，并且允许叠加；这样一组readonly和一个writeable的结构构成一个container运行时态，每个FS被称为一个FS层。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic.fetch150zy.cn/assets/dockerCore3.jpg"
                      alt="image"
                ></p>
<blockquote>
<p>  由于AUFS，每一个对readonly层文件、目录的修改都只会存在于上层的writeable层中。这样由于不存在竞争，多个container可以共享readonly的FS层。所以Docker将readonly的FS层称为”image” - 对于container而言整个rootfs都是read-write的，但事实上所有的修改都写入最上层的writeable层中，image不保护用户状态，只用于模板，新建和复制使用。</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic.fetch150zy.cn/assets/dockerCore4.jpg"
                      alt="image"
                ></p>
<blockquote>
<p>  上层的image依赖下层的image，因此在Docker中把下层的image称为父image，没有父image的image称为base image。因此想要从一个image中启动一个container，Docker会先加载这个image依赖的父image以及base image；用户的进程运行在writeable的layer中。所有的parent image中的数据信息以及ID、网络和lxc管理的资源限制等具体container的配置，构成一个Docker概念上的container。</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic.fetch150zy.cn/assets/dockerCore5.jpg"
                      alt="image"
                ></p>
</li>
</ul>
<h3 id="安全性-AppArmor，SELinux，GRSEC"><a href="#安全性-AppArmor，SELinux，GRSEC" class="headerlink" title="安全性 AppArmor，SELinux，GRSEC"></a>安全性 AppArmor，SELinux，GRSEC</h3><ul>
<li>由kernel namespace和cgroup实现的Linux系统固有的安全标准</li>
<li>Docker Deamon的安全接口</li>
<li>Linux本身的安全加固解决方案，类似AppArmor，SELinux</li>
</ul>
<h2 id="Docker-快速入门"><a href="#Docker-快速入门" class="headerlink" title="Docker 快速入门"></a>Docker 快速入门</h2><h3 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h3><ul>
<li><p>docker配置文件</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/ect/docker/</span><br><span class="line">/var/lib/docker/</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>安装</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Syu</span><br><span class="line">sudo pacman -S docker</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>运行配置</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动docker</span></span><br><span class="line">sudo systemctl start docker.service</span><br><span class="line">sudo systemctl start docker</span><br><span class="line"><span class="comment"># 开机启动</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker.service</span><br><span class="line"><span class="comment"># 关闭docker</span></span><br><span class="line">sudo systemctl stop docker</span><br><span class="line"><span class="comment"># 重启docker</span></span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"><span class="comment"># 查看docker状态</span></span><br><span class="line">sudo systemctl status docker</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看version</span></span><br><span class="line">sudo docker version</span><br><span class="line"><span class="comment"># 查看docker信息</span></span><br><span class="line">sudo docker info</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>不通过root运行docker</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  重启后奏效</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a>Docker镜像</h3><h4 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h4><ul>
<li><p>基础镜像信息</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>维护者信息</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">MAINTAINER</span> fetch150zy &lt;Mars_zhewei@outlook.com&gt;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>镜像操作指令</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;deb http://archive.ubuntu.com/ubuntu/ raring main universe&quot;</span> &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y nginx</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;\ndaemon off;&quot;</span> &gt;&gt; /etc/nginx/nginx.conf</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>容器启动时执行指令</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /usr/sbin/nginx</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<p>example:</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># VERSION               0.0.1</span></span><br><span class="line"><span class="keyword">FROM</span>      ubuntu</span><br><span class="line"><span class="keyword">MAINTAINER</span> Victor Vieux &lt;victor@docker.com&gt;</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y inotify-tools nginx apache2 openssh-server</span></span><br><span class="line"><span class="comment"># Firefox over VNC</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># VERSION               0.3</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="comment"># Install vnc, xvfb in order to create a &#x27;fake&#x27; display and firefox</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y x11vnc xvfb firefox</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> /.vnc</span></span><br><span class="line"><span class="comment"># Setup a password</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> x11vnc -storepasswd 1234 ~/.vnc/passwd</span></span><br><span class="line"><span class="comment"># Autostart firefox (might not be the best way, but it does the trick)</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> bash -c <span class="string">&#x27;echo &quot;firefox&quot; &gt;&gt; /.bashrc&#x27;</span></span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">5900</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash">    [<span class="string">&quot;x11vnc&quot;</span>, <span class="string">&quot;-forever&quot;</span>, <span class="string">&quot;-usepw&quot;</span>, <span class="string">&quot;-create&quot;</span>]</span></span><br><span class="line"><span class="comment"># Multiple images example</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># VERSION               0.1</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> foo &gt; bar</span></span><br><span class="line"><span class="comment"># Will output something like ===&gt; 907ad6c2736f</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> moo &gt; oink</span></span><br><span class="line"><span class="comment"># Will output something like ===&gt; 695d7793cbe4</span></span><br><span class="line"><span class="comment"># You᾿ll now have two images, 907ad6c2736f with /bar, and 695d7793cbe4 with</span></span><br><span class="line"><span class="comment"># /oink.</span></span><br></pre></td></tr></table></figure></div>



<h4 id="Docker镜像操作"><a href="#Docker镜像操作" class="headerlink" title="Docker镜像操作"></a>Docker镜像操作</h4><ul>
<li><p>查找获取镜像</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找所需镜像</span></span><br><span class="line">docker search hello-world</span><br><span class="line"><span class="comment"># 拉取镜像</span></span><br><span class="line">docker pull hello-world</span><br><span class="line">docker image pull hello-world</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>查看已有镜像</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看镜像</span></span><br><span class="line">docker images</span><br><span class="line">docker image <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># 查看镜像历史信息</span></span><br><span class="line">docker <span class="built_in">history</span> hello-world:latest</span><br><span class="line">docker image <span class="built_in">history</span> hello-world:latest</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>备份镜像</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker tag hello-world:latest hello-world:v2.0</span><br><span class="line">docker image tag hello-world:latest hello-world:v1.0</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>删除镜像</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rmi hello-world:latest</span><br><span class="line">docker image <span class="built_in">rm</span> hello-world:latest</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>清除未使用的镜像</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>导出导入镜像</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导出tar包</span></span><br><span class="line">docker save -o hello-world:latest.tar.gz hello-world:latest</span><br><span class="line">docker image save -o hello-world:latest.tar.gz hello-world:latest</span><br><span class="line"><span class="comment"># 导入</span></span><br><span class="line">docker load -i hello-world:latest.tar.gz</span><br><span class="line">docker image load -i hello-world:latest.tar.gz</span><br></pre></td></tr></table></figure></div></li>
</ul>
<h4 id="Dockerfile操作建议"><a href="#Dockerfile操作建议" class="headerlink" title="Dockerfile操作建议"></a>Dockerfile操作建议</h4><ul>
<li><p>dockerfile尽量越简洁越好</p>
</li>
<li><p>最好把dockerfile放在一个空目录，或者使用.dockerignore文件排除</p>
</li>
<li><p>尽量避免安装不需要的包</p>
</li>
<li><p>一个镜像只跑一个process</p>
</li>
<li><p>在dockerfile可读性和镜像层次最小化之间取得平衡</p>
</li>
<li><p>构建缓存</p>
<blockquote>
<p>  在构建镜像时，进程将为dockerfile内每一个指定的执行步骤构建一个镜像。</p>
<p>  执行指令时会对镜像缓存检查，镜像是可以重复利用的。</p>
<p>  如果不想使用缓存，在docker build 时使用 –no-cach&#x3D;true</p>
</blockquote>
<ul>
<li>从缓存中启动一个基础镜像，执行下一条指令，与上一层所有子镜像对比，查看是否与已经存在的镜像相同，如果不同缓存失效</li>
<li>大多数只需要简单比较dockerfile指令与其中的一个子镜像就够了<ul>
<li>对于ADD和COPY指令，镜像中的文件每个的内容将全部检查</li>
<li>docker会与已经存在的镜像文件进行校验，如果内容或元数据被更改，缓存失效</li>
<li>ADD和COPY指令缓存将不会查看容器内文件来匹配缓存</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>  镜像文件的大小</p>
</blockquote>
<p>dockerfile中的每一条指令都对应Docker镜像中的一层</p>
<p><strong>exp:</strong></p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">14.04</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> run.sh /</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> /data</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;./run.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic.fetch150zy.cn/assets/dockerfile.jpg"
                      alt="Dockerfile 操作建议 - 图1"
                ></p>
<p><strong>构建 Docker 镜像时，对当前的文件系统造成了修改更新</strong></p>
<ol>
<li>ADD和COPY命令，在docker build构建镜像时向容器中添加内容。如果内容添加成功，那么构建的那层镜像大小就是添加内容的大小</li>
<li>RUN命令，如果运行的命令涉及磁盘文件更新，该层镜像大小就是文件系统的增量修改部分</li>
</ol>
<blockquote>
<p>  联合文件系统</p>
</blockquote>
<p><strong>镜像总大小是每一层镜像大小的总和</strong></p>
<ul>
<li>联合文件系统的性质保证相同文件的镜像层，容器仅能看到一个</li>
</ul>
<blockquote>
<p>  镜像共享关系</p>
</blockquote>
<ul>
<li>多个不同的docker镜像可以共享相同的镜像层</li>
</ul>
<h4 id="Dockerfile参数详解"><a href="#Dockerfile参数详解" class="headerlink" title="Dockerfile参数详解"></a>Dockerfile参数详解</h4><ul>
<li><p>FROM</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> &lt;image&gt;</span><br><span class="line"><span class="keyword">FROM</span> &lt;image&gt;:&lt;tag&gt;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  如果想在同一个dockerfile中创建多个镜像时，可以使用多个FROM指令</p>
</blockquote>
</li>
<li><p>MAINTAINER（指定维护者信息）</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">MAINTAINER</span> &lt;name&gt;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>RUN（运行命令）</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> &lt;<span class="built_in">command</span>&gt;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  第一个在shell终端中运行命令</p>
<p>  第二个使用exec执行，也可以指定其它终端</p>
<p>  <code>RUN [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;echo hello&quot;]</code></p>
</blockquote>
</li>
<li><p>CMD（容器启动时执行的命令）</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;executable&quot;</span>,<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;param2&quot;</span>] 使用 <span class="built_in">exec</span> 执行，推荐方式；</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">command</span> param1 param2 在 /bin/sh 中执行，提供给需要交互的应用；</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;param2&quot;</span>] 提供给 ENTRYPOINT 的默认参数；</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  每个dockerfile只能有一条CMD命令</p>
</blockquote>
</li>
<li><p>EXPOSE（暴露的端口号）</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> &lt;port&gt; [&lt;port&gt;...]</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  docker主机会自动分配一个端口转发到指定的端口</p>
</blockquote>
</li>
<li><p>ENV（指定环境变量）</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> PG_MAJOR <span class="number">9.3</span></span><br><span class="line"><span class="keyword">ENV</span> PG_VERSION <span class="number">9.3</span>.<span class="number">4</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> curl -SL http://example.com/postgres-<span class="variable">$PG_VERSION</span>.tar.xz | tar -xJC /usr/src/postgress &amp;&amp; …</span></span><br><span class="line"><span class="keyword">ENV</span> PATH /usr/local/postgres-$PG_MAJOR/bin:$PATH</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  指定使用环境并在容器运行时保持</p>
</blockquote>
</li>
<li><p>ADD</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> &lt;src&gt; &lt;dest&gt;</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  复制到容器中，可以是URL或tar文件（自动解压为目录）</p>
</blockquote>
</li>
<li><p>COPY</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> &lt;src&gt; &lt;dest&gt;</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  复制本地主机内容（Dockerfile所在目录的相对路径）到容器中</p>
<p>  当使用本地目录作为源目录时，推荐使用COPY</p>
</blockquote>
</li>
<li><p>ENTERPOINT</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> <span class="built_in">command</span> param1 param2（shell中执行）。</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  配置容器启动后执行的命令，并且不可被docker run提供的参数覆盖</p>
<p>  每个dockerfile只能有一个ENTERPOINT</p>
</blockquote>
</li>
<li><p>VOLUME</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;/data&quot;</span>]</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  创建一个可以从本地主机或其它容器挂载的挂载点，一般用来存放数据库和需要保持的数据等</p>
</blockquote>
</li>
<li><p>USER</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USER</span> daemon</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  指定运行容器的用户名或UID，后续的RUN也会使用指定用户</p>
<p>  当服务不需要管理员权限时，可以通过该命令指定运行用户，并可以在之前创建所需要的用户</p>
</blockquote>
</li>
<li><p>WORKDIR</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /path/to/workdir</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  为后续的RUN、CMD、ENTERPOINT指令配置工作目录</p>
</blockquote>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /a</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> b</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> c</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">pwd</span></span></span><br><span class="line"><span class="comment"># 最终路径为 /a/b/c</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>ONBUILD</p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ONBUILD</span> [INSTRUCTION]</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  配置当所创建的镜像作为其它新创建镜像的基础镜像时，所执行的操作指令</p>
</blockquote>
<p><strong>exp:</strong></p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">ADD</span><span class="language-bash"> . /app/src</span></span><br><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">RUN</span><span class="language-bash"> /usr/local/bin/python-build --<span class="built_in">dir</span> /app/src</span></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure></div>

<p><strong>基于上面创建的镜像来创建新的镜像</strong></p>
<div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> image-A</span><br><span class="line"><span class="comment">#Automatically run the following</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> . /app/src</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> /usr/local/bin/python-build --<span class="built_in">dir</span> /app/src</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<h3 id="Docker容器"><a href="#Docker容器" class="headerlink" title="Docker容器"></a>Docker容器</h3><h4 id="Docker容器操作"><a href="#Docker容器操作" class="headerlink" title="Docker容器操作"></a>Docker容器操作</h4><ul>
<li><p>查看所有容器</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker ps 		<span class="comment"># 默认只显示启动的容器</span></span><br><span class="line">docker ps -a	<span class="comment"># 显示所有容器状态</span></span><br><span class="line">docker ps -q	<span class="comment"># 查看容器编号</span></span><br><span class="line">docker ps -l 	<span class="comment"># 展示最近一次创建的容器状态</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>守护进程启动容器</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name ngx nginx:latest</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>启动容器</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker start ngx</span><br><span class="line"><span class="comment"># 也可一次启动多个容器</span></span><br><span class="line">docker start ngx ubuntu redis</span><br><span class="line"><span class="comment"># 重新启动容器</span></span><br><span class="line">docker restart ngx </span><br></pre></td></tr></table></figure></div>
</li>
<li><p>停止容器</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker stop ngx</span><br><span class="line">docker container stop ngx</span><br><span class="line"><span class="comment"># 也可一次停止多个容器</span></span><br><span class="line">docker stop ngx ubuntu redis</span><br><span class="line"><span class="comment"># sigkill </span></span><br><span class="line">docker <span class="built_in">kill</span> ngx</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>删除容器</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> ngx</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  批量删除正在运行的容器</p>
</blockquote>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> $(docker ps -q) -f </span><br><span class="line">-f		强制</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>创建容器并进入</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name ngx -P nginx:latest /bin/bash</span><br><span class="line">- i 		交互</span><br><span class="line">- t 		<span class="built_in">tty</span></span><br><span class="line">-- name 	指定容器名</span><br><span class="line">- P 		随机分配一个主机端口到容器端口的映射</span><br><span class="line">- p 		指定端口映射 exp: 5000:5000</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  重新进入容器</p>
</blockquote>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it ngx /bin/bash</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>通过容器创建镜像</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m <span class="string">&quot;message&quot;</span> -a <span class="string">&quot;author&quot;</span> ngx nginx:v1.0</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>查看镜像容器全部信息</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect nginx:latest</span><br><span class="line">docker container inspect ngx</span><br><span class="line">-f 参数可以筛选出想要的信息</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>打印容器操作事件</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker events -f <span class="string">&#x27;event=stop&#x27;</span> --since <span class="string">&#x27;3m&#x27;</span></span><br><span class="line">-f 		过滤</span><br><span class="line">--since 按时间筛选</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>查看容器网络端口</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker port app 5000</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>查看容器中应用服务进程</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker top app</span><br><span class="line">PID                 USER                COMMAND</span><br><span class="line">854                 root                python app.py</span><br></pre></td></tr></table></figure></div>
</li>
<li></li>
</ul>
<h4 id="容器入门"><a href="#容器入门" class="headerlink" title="容器入门"></a>容器入门</h4><p><strong>绑定容器到另外一个主机&#x2F;端口或者一个Unix Socket</strong></p>
<blockquote>
<p>  使用 -H 能够让Docker daemon监听特殊的IP和端口</p>
<blockquote>
<p>  默认情况下监听unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock以仅允许root进行本地连接。你可以将他设置为0.0.0.0：2375或者是指定的主机IP以供所有人连接，但是不建议这么做</p>
</blockquote>
<p>  类似的，Docker客户端也可以使用 -H 连接一个指定端口</p>
<p>  -H 使用以下格式来分配主机和端口</p>
<p>  <code>tcp://[host][:port][path]</code> or <code>unix://path</code></p>
</blockquote>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcp://host:2375 -&gt; TCP connection on host:2375</span><br><span class="line">tcp://host:2375/path -&gt; TCP connection on host:2375 and prepend path to all requests</span><br><span class="line">unix://path/to/socket -&gt; Unix socket located at path/to/socket</span><br></pre></td></tr></table></figure></div>

<p><strong>Docker以daemon模式运行</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo &lt;path to&gt;/docker daemon -H 0.0.0.0:5555 &amp;</span><br><span class="line"><span class="comment"># 下载一个ubuntu镜像</span></span><br><span class="line">$ docker -H :5555 pull ubuntu</span><br><span class="line"><span class="comment"># 如果你想同时监听TCP和Unix Socket 你可以添加多个 －H</span></span><br><span class="line"><span class="comment"># Run docker in daemon mode</span></span><br><span class="line">$ sudo &lt;path to&gt;/docker daemon -H tcp://127.0.0.1:2375 -H unix:///var/run/docker.sock &amp;</span><br><span class="line"><span class="comment"># Download an ubuntu image, use default Unix socket</span></span><br><span class="line">$ docker pull ubuntu</span><br><span class="line"><span class="comment"># OR use the TCP port</span></span><br><span class="line">$ docker -H tcp://127.0.0.1:2375 pull ubuntu</span><br></pre></td></tr></table></figure></div>

<p><strong>起一个持续工作的进程</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ JOB=$(docker run -d ubuntu /bin/sh -c <span class="string">&quot;while true; do echo Hello world; sleep 1; done&quot;</span>)</span><br><span class="line">$ docker logs <span class="variable">$JOB</span></span><br><span class="line">$ docker <span class="built_in">kill</span> <span class="variable">$JOB</span></span><br></pre></td></tr></table></figure></div>

<p><strong>在一个TCP端口上绑定一个服务</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Bind port 4444 of this container, and tell netcat to listen on it</span></span><br><span class="line">$ JOB=$(docker run -d -p 4444 ubuntu:12.10 /bin/nc -l 4444)</span><br><span class="line"><span class="comment"># Which public port is NATed to my container?</span></span><br><span class="line">$ PORT=$(docker port <span class="variable">$JOB</span> 4444 | awk -F: <span class="string">&#x27;&#123; print $2 &#125;&#x27;</span>)</span><br><span class="line"><span class="comment"># Connect to the public port</span></span><br><span class="line">$ <span class="built_in">echo</span> hello world | nc 127.0.0.1 <span class="variable">$PORT</span></span><br><span class="line"><span class="comment"># Verify that the network connection worked</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Daemon received: <span class="subst">$(docker logs $JOB)</span>&quot;</span></span><br></pre></td></tr></table></figure></div>



<h4 id="管理容器的数据"><a href="#管理容器的数据" class="headerlink" title="管理容器的数据"></a>管理容器的数据</h4><blockquote>
<p>  docker 管理数据主要有两种方式，数据卷以及数据卷容器</p>
<blockquote>
<p>  数据卷是在一个或多个容器，它绕过UFS的一个专门指定的目录。数据卷为持续共享数据提供了一些有用的功能</p>
</blockquote>
<ul>
<li>在创建容器时，卷被初始化。如果容器的基础映像包含指定的数据装入点，现有的数据复制到在卷初始化新卷</li>
<li>数据卷可以共享和容器之间重复使用</li>
<li>改变数据卷将立刻生效</li>
<li>改变数据卷数据不会影响到容器</li>
<li>即使容器本身被删除，但是数据卷依然存在</li>
<li>数据卷的目的是持久化数据，独立于容器的声明周期。Docker因此不会自动删除卷，当你删除一个容器，也不会“垃圾回收”直到没有容器再使用</li>
</ul>
</blockquote>
<ul>
<li><p>添加一个数据卷</p>
<p><code>docker run</code> 加上 <code>- v</code>参数来添加一个数据卷，<code>- v</code>参数可以多次使用来挂载多个数据卷</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name web -v /webapp training/webapp python app.py</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  这条命令在容器中的&#x2F;webapp文件夹下创建一个数据卷存储数据</p>
<blockquote>
<p>  你也可以在构建镜像时在dockerfile里面定义</p>
</blockquote>
<p>  数据卷默认权限是读写，你也可以设置为只读</p>
  <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name web -v /opt/webapp:ro training/webapp python app.py</span><br></pre></td></tr></table></figure></div>

<p>  查找数据卷路径用<code>docker inspect</code>命令定位</p>
  <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect web</span><br></pre></td></tr></table></figure></div>

  <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Mounts<span class="string">&quot;: [</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        &quot;</span>Name<span class="string">&quot;: &quot;</span>fac362...80535<span class="string">&quot;,</span></span><br><span class="line"><span class="string">        &quot;</span>Source<span class="string">&quot;: &quot;</span>/var/lib/docker/volumes/fac362...80535/_data<span class="string">&quot;,</span></span><br><span class="line"><span class="string">        &quot;</span>Destination<span class="string">&quot;: &quot;</span>/webapp<span class="string">&quot;,</span></span><br><span class="line"><span class="string">        &quot;</span>Driver<span class="string">&quot;: &quot;</span><span class="built_in">local</span><span class="string">&quot;,</span></span><br><span class="line"><span class="string">        &quot;</span>Mode<span class="string">&quot;: &quot;</span><span class="string">&quot;,</span></span><br><span class="line"><span class="string">        &quot;</span>RW<span class="string">&quot;: true</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"># 可以看见权限RW为true</span></span><br></pre></td></tr></table></figure></div>
</blockquote>
</li>
<li><p>挂载一个主机目录作为数据卷</p>
<blockquote>
<p>  挂载主机目录为数据卷，必须参照 <code>-v hostPath:containerPath</code>这种格式，路径必须为绝对路径，以保证容器的可移植性</p>
</blockquote>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py</span><br><span class="line"><span class="comment"># 加载主机的 /src/webapp 目录到容器的 /opts/webapp 目录</span></span><br><span class="line"><span class="comment"># docker 数据卷的权限为读写，你也可以设置为只读</span></span><br><span class="line">$ docker run -d -P --name web -v /src/webapp:/opt/webapp:ro training/webapp python app.py</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>挂载一个数据文件作为数据卷</p>
<p><code>- v</code>标记也可以从主机挂载单个文件到容器中</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run --<span class="built_in">rm</span> -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash</span><br><span class="line"><span class="comment"># 这样可以记录在容器中输入过的命令了</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  如果想挂载一个文件，最简单的方式是直接挂载文件的父目录</p>
</blockquote>
</li>
<li><p>创建和挂载数据卷容器</p>
<p><strong>如果你有一些持续更新的数据想在容器间共享，最好创建数据卷容器</strong></p>
<blockquote>
<p>  数据卷容器其实就是一个正常的容器，专门用来提供数据卷供其它容器挂载的</p>
</blockquote>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个命名的数据卷容器dbdata</span></span><br><span class="line">$ sudo docker run -d -v /dbdata --name dbdata training/postgres <span class="built_in">echo</span> Data-only container <span class="keyword">for</span> postgres</span><br><span class="line"><span class="comment"># 然后在其它容器中使用 --volume-from 来挂载dbdata容器中的数据卷</span></span><br><span class="line">$ sudo docker run -d --volumes-from dbdata --name db1 training/postgres</span><br><span class="line">$ sudo docker run -d --volumes-from dbdata --name db2 training/postgres</span><br><span class="line"><span class="comment"># 还可以使用 --volume-from 参数来从多个容器挂载多个数据卷，也可以从其它已经挂载了数据卷的容器来挂载数据卷</span></span><br><span class="line">$ sudo docker run -d --name db3 --volumes-from db1 training/postgres</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  注意：使用 –volumes-from 参数所挂载数据卷的容器自己并不需要保持在运行状态</p>
<p>  如果删除了挂载的容器（包括dbdata, db1, db2），数据卷并不会被自动删除。如果要删除一个数据卷，必须在删除最后一个还挂载着它的容器时使用 docker rm -v 命令来指定同时删除关联的容器。 这可以让用户在容器之间升级和移动数据卷</p>
</blockquote>
</li>
<li><p>备份、存储、移动数据卷</p>
<ul>
<li><p>备份</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --volumes-from dbdata -v $(<span class="built_in">pwd</span>):/backup ubuntu tar cvf /backup/backup.tar /dbdata</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>创建新容器</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -v /dbdata --name dbdata2 ubuntu /bin/bash</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>解压数据卷挂载到容器</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --volumes-from dbdata2 -v $(<span class="built_in">pwd</span>):/backup ubuntu <span class="built_in">cd</span> /dbdata &amp;&amp; tar xvf /backup/backup.tar</span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
</ul>
<h4 id="管理容器的通信"><a href="#管理容器的通信" class="headerlink" title="管理容器的通信"></a>管理容器的通信</h4><ul>
<li><p>容器与宿主机采用端口映射的方式通信</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动容器 -P 随机分配端口</span></span><br><span class="line">$ docker run -d -P training/webapp python app.py</span><br><span class="line"><span class="comment"># 查看端口映射状态</span></span><br><span class="line">$ docker ps nostalgic_morse</span><br><span class="line"><span class="comment"># 使用 -p 指定端口映射</span></span><br><span class="line">$ docker run -d -p 80:5000 training/webapp python app.py</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  <code>- p</code>参数的其它指定方法</p>
  <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ip:hostPort:containerPort  映射指定IP的指定端口</span><br><span class="line">ip::containerPort          映射指定IP任意端口</span><br><span class="line">hostPort:containerPort。    映射所有主机IP的指定端口</span><br></pre></td></tr></table></figure></div>
</blockquote>
</li>
<li><p>采用link方式通信</p>
<blockquote>
<p>  为了方便建立连接，通常需要为容器起一个name，如果不起，你会发现系统会自动分配一个名字</p>
  <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name web training/webapp python app.py</span><br></pre></td></tr></table></figure></div>
</blockquote>
<p><strong>links允许容器发现另一个容器，并在期间建立一个安全的通道以便交换数据，使用–link参数来创建一个连接</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name db training/postgres</span><br><span class="line"><span class="comment"># 创建一个web连接到db数据库容器</span></span><br><span class="line">$ docker run -d -P --name web --<span class="built_in">link</span> db:db training/webapp python app.py</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  参数格式如下：</p>
<p>  <code>--link &lt;name or id&gt;:alias</code> alias代表你为这个链接起的一个别名</p>
<p>  该参数将匹配容器name并建立连接</p>
  <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -P --name web --<span class="built_in">link</span> db training/webapp python app.py</span><br></pre></td></tr></table></figure></div>

<p>  使用 <code>docker inspect</code>定位</p>
  <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect -f <span class="string">&quot;&#123;&#123; .HostConfig.Links &#125;&#125;&quot;</span> web</span><br><span class="line">[/db:/web/db]</span><br></pre></td></tr></table></figure></div>
</blockquote>
<p><strong>一个创建在源容器与目标容器之间的连接允许源容器提供信息给目标容器。目标容器web可以获取源容器db提供的信息，为了实现这个功能，docker在这两个容器之间创建一个稳定的通道，并且不会暴露任何端口</strong></p>
<ul>
<li><p>环境变量</p>
<blockquote>
<p>  当link容器时，docker会创建许多环境变量，Docker会自动创建环境变量到目标容器中去</p>
<p>  也会通过docker暴露源容器的所有环境变量，这些变量来自：</p>
<ul>
<li>Dockerfile中ENV命令定义的环境变量</li>
<li>在启动源容器时使用 <code>-e</code> <code>--env</code> <code>--env-file</code>参数附加的环境变量</li>
</ul>
<p>  这些环境变量使程序从相关的目标容器中发现源容器</p>
<blockquote>
<p>  Docker为每一个在–link参数中的容器设置了一个_NAME环境变量。</p>
<p>  例如：一个web容器通过<code>--link db : webdb </code>连接db容器，将会在web容器中创建一个WEBDB_NAME&#x3D;&#x2F;web&#x2F;webdb环境变量</p>
</blockquote>
<p>  Docker为源容器暴露的端口限定了一组环境变量，每一个环境变量具有唯一前缀形式</p>
  <div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;name&gt;_PORT_&lt;port&gt;_&lt;protocol&gt;</span><br></pre></td></tr></table></figure></div>

<p>  前缀的构成：</p>
<ul>
<li>是–link : 后面的参数（webdb）</li>
<li>就是暴露的端口号</li>
<li>TCP &#x2F; UDP</li>
</ul>
<p>  Docker 利用这前缀格式定义了三个不同的环境变量</p>
<blockquote>
<p>  prefix_ADDR 变量包含了来自URL的IP地址,</p>
</blockquote>
  <div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WEBDB_PORT_5432_TCP_ADDR=<span class="number">172.17</span>.<span class="number">0.82</span>.</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  prefix_PORT 变量仅包含了URL的端口号</p>
</blockquote>
  <div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WEBDB_PORT_5432_TCP_PORT=<span class="number">5432</span>.</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  prefix_PROTO 参数包含URL的传输协议</p>
</blockquote>
  <div class="highlight-container" data-rel="Dockerfile"><figure class="iseeu highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WEBDB_PORT_5432_TCP_PROTO=tcp.</span><br></pre></td></tr></table></figure></div>

<p>  如果容器暴露多个端口，Docker将会为每个端口创建三个环境变量</p>
<p>  <strong>另外，Docker也要创建一个叫 _PORT的环境变量。这个变量包含源容器URL首次暴露的IP和端口，该端口的“首次”定义为最低级数字的端口</strong></p>
<p>  <strong>最后，Docker会把源容器中的环境变量暴露给目标容器作为环境变量。并且Docker会在目标容器为每个变量创建一个ENV变量。这个变量的值被设置为启动源程序Docker所用到的值</strong></p>
</blockquote>
<p><strong>你可以使用env命令列出具体的容器环境变量</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --<span class="built_in">rm</span> --name web2 --<span class="built_in">link</span> db:db training/webapp <span class="built_in">env</span></span><br><span class="line">. . .</span><br><span class="line">DB_NAME=/web2/db</span><br><span class="line">DB_PORT=tcp://172.17.0.5:5432</span><br><span class="line">DB_PORT_5432_TCP=tcp://172.17.0.5:5432</span><br><span class="line">DB_PORT_5432_TCP_PROTO=tcp</span><br><span class="line">DB_PORT_5432_TCP_PORT=5432</span><br><span class="line">DB_PORT_5432_TCP_ADDR=172.17.0.5</span><br><span class="line">. . .</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  你可以看到Docker利用许多有关源容器的信息创建了一些列的环境变量。每一环境变量都会带有指点定义的别名，DB前缀。如果别名是db1，那么变量前缀也会变成DB1。利用这些环境变量来配置应用用在db容器上连接数据库。这样的连接方式稳定安全私有化，只有已获得连接的web容器才会有对db容器的访问权限</p>
</blockquote>
<p><strong>一些注意事项</strong></p>
<blockquote>
<p>  与修改<code>/etc/hosts</code>文件不同，在环境变量中存储的IP地址信息不会随着容器的重启而更新，建议利用hosts文件来解决连接容器的IP地址问题</p>
<p>  这些环境变量只是为容器的第一个process设置，某些daemon后台服务，例如sshd，只有当产生连接需求时才会设置</p>
</blockquote>
</li>
<li><p>更新 <code>/etc/hosts</code>文件</p>
<blockquote>
<p>  处理环境变量，docker在源文件中追加了host信息，这里向web容器追加</p>
  <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -t -i --<span class="built_in">rm</span> --<span class="built_in">link</span> db:webdb training/webapp /bin/bash</span><br><span class="line">root@aed84ee21bde:/opt/webapp<span class="comment"># cat /etc/hosts</span></span><br><span class="line">172.17.0.7  aed84ee21bde</span><br><span class="line">. . .</span><br><span class="line">172.17.0.5  webdb 6e5cdeb2d300 db</span><br></pre></td></tr></table></figure></div>

<p>  我们可以在容器中使用ping命令测试链接</p>
  <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@aed84ee21bde:/opt/webapp<span class="comment"># apt-get install -yqq inetutils-ping</span></span><br><span class="line">root@aed84ee21bde:/opt/webapp<span class="comment"># ping webdb</span></span><br><span class="line">PING webdb (172.17.0.5): 48 data bytes</span><br><span class="line">56 bytes from 172.17.0.5: icmp_seq=0 ttl=64 time=0.267 ms</span><br><span class="line">56 bytes from 172.17.0.5: icmp_seq=1 ttl=64 time=0.250 ms</span><br><span class="line">56 bytes from 172.17.0.5: icmp_seq=2 ttl=64 time=0.256 ms</span><br></pre></td></tr></table></figure></div>

<p>  如果你重启源容器，连接依然存在</p>
  <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker restart db</span><br><span class="line">db</span><br><span class="line">$ docker run -t -i --<span class="built_in">rm</span> --<span class="built_in">link</span> db:db training/webapp /bin/bash</span><br><span class="line">root@aed84ee21bde:/opt/webapp<span class="comment"># cat /etc/hosts</span></span><br><span class="line">172.17.0.7  aed84ee21bde</span><br><span class="line">. . .</span><br><span class="line">172.17.0.9  db</span><br></pre></td></tr></table></figure></div></blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="其它Docker操作"><a href="#其它Docker操作" class="headerlink" title="其它Docker操作"></a>其它Docker操作</h3><h4 id="日志相关"><a href="#日志相关" class="headerlink" title="日志相关"></a>日志相关</h4><ul>
<li><p>打印运行日志</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f app</span><br><span class="line"><span class="comment"># -f 参数可以查看容器标准输出</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<h4 id="仓库服务相关"><a href="#仓库服务相关" class="headerlink" title="仓库服务相关"></a>仓库服务相关</h4><ul>
<li><p>登入登出</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输入docker id 和密码</span></span><br><span class="line">docker login</span><br><span class="line">docker <span class="built_in">logout</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>  如果有自己的仓库</p>
</blockquote>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker login localhost:8080</span><br><span class="line">docker <span class="built_in">logout</span> localhost:8080</span><br></pre></td></tr></table></figure></div></li>
</ul>
<h3 id="Docker基本指令及用法"><a href="#Docker基本指令及用法" class="headerlink" title="Docker基本指令及用法"></a>Docker基本指令及用法</h3><h4 id="环境信息相关"><a href="#环境信息相关" class="headerlink" title="环境信息相关"></a>环境信息相关</h4><ul>
<li>info</li>
<li>version</li>
</ul>
<h4 id="系统运维相关"><a href="#系统运维相关" class="headerlink" title="系统运维相关"></a>系统运维相关</h4><ul>
<li>attach</li>
<li>build</li>
<li>commit</li>
<li>cp</li>
<li>diff</li>
<li>export</li>
<li>images</li>
<li>import</li>
<li></li>
</ul>
<h4 id="日志信息相关"><a href="#日志信息相关" class="headerlink" title="日志信息相关"></a>日志信息相关</h4><h4 id="仓库服务相关-1"><a href="#仓库服务相关-1" class="headerlink" title="仓库服务相关"></a>仓库服务相关</h4><h3 id="搭建私有仓库"><a href="#搭建私有仓库" class="headerlink" title="搭建私有仓库"></a>搭建私有仓库</h3><blockquote>
<p>  备份镜像，方便使用</p>
</blockquote>
<h4 id="如何搭建私有仓库"><a href="#如何搭建私有仓库" class="headerlink" title="如何搭建私有仓库"></a>如何搭建私有仓库</h4><ul>
<li><p>下载仓库镜像</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>配置私有仓库<code>/etc/docker/daemon.json</code></p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;insecure-registries&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;192.168.10.6:5000&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>重启docker</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>创建registry容器（关联私有仓库的配置）</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 --name registry registry:latest</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>备份镜像名字</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag ubuntu:latest 192.168.10.6:5000/ubuntu-copy</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>推送镜像到私有仓库</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push 192.168.10.6:5000/ubuntu-copy</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>拉取私有仓库镜像</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull 192.168.10.6:5000/ubuntu-copy</span><br></pre></td></tr></table></figure></div></li>
</ul>

        </div>

        

        
            <ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/Docker/">#Docker</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2023/01/04/2023-01-04-objdump/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">objdump</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2022/11/16/2022-11-16-rust-on-manjaro/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Rust环境配置</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此页目录</div>
        <div class="page-title">Docker</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker"><span class="nav-text">Docker</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#docker-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF"><span class="nav-text">docker 核心技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%94%E7%A6%BB%E6%80%A7-Linux-namespace"><span class="nav-text">隔离性 Linux namespace</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E7%BB%84-Cgroups"><span class="nav-text">控制组 Cgroups</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%BF%E6%90%BA%E6%80%A7%EF%BC%9AAUFS"><span class="nav-text">便携性：AUFS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7-AppArmor%EF%BC%8CSELinux%EF%BC%8CGRSEC"><span class="nav-text">安全性 AppArmor，SELinux，GRSEC</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="nav-text">Docker 快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker%E5%AE%89%E8%A3%85"><span class="nav-text">Docker安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker%E9%95%9C%E5%83%8F"><span class="nav-text">Docker镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-text">基本结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Docker%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C"><span class="nav-text">Docker镜像操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dockerfile%E6%93%8D%E4%BD%9C%E5%BB%BA%E8%AE%AE"><span class="nav-text">Dockerfile操作建议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dockerfile%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3"><span class="nav-text">Dockerfile参数详解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker%E5%AE%B9%E5%99%A8"><span class="nav-text">Docker容器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Docker%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C"><span class="nav-text">Docker容器操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E5%85%A5%E9%97%A8"><span class="nav-text">容器入门</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E5%AE%B9%E5%99%A8%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-text">管理容器的数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E5%AE%B9%E5%99%A8%E7%9A%84%E9%80%9A%E4%BF%A1"><span class="nav-text">管理容器的通信</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E5%AE%83Docker%E6%93%8D%E4%BD%9C"><span class="nav-text">其它Docker操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E7%9B%B8%E5%85%B3"><span class="nav-text">日志相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%93%E5%BA%93%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3"><span class="nav-text">仓库服务相关</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4%E5%8F%8A%E7%94%A8%E6%B3%95"><span class="nav-text">Docker基本指令及用法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF%E7%9B%B8%E5%85%B3"><span class="nav-text">环境信息相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3"><span class="nav-text">系统运维相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF%E7%9B%B8%E5%85%B3"><span class="nav-text">日志信息相关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%93%E5%BA%93%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3-1"><span class="nav-text">仓库服务相关</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93"><span class="nav-text">搭建私有仓库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93"><span class="nav-text">如何搭建私有仓库</span></a></li></ol></li></ol></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">fetch150zy</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        共 52 篇文章
                    </span>
                    
                </p>
            
        </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span>
            <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.6.1</a></span>
        </div>
        
        
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>







    
<script src="/js/layouts/lazyload.js" type="module"></script>






  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>









<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
